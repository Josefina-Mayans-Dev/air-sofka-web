import{c as N}from"./chunk-SRAEFGWB.js";import{$ as w,A as O,Ab as V,G as A,La as $,Q as p,R as L,U as k,Ua as R,Y as h,d as M,da as _,ea as v,f,fa as i,ga as o,h as F,ha as u,i as D,k as T,ka as P,m as I,ma as m,na as S,q as U,qa as r,s as j,sa as b,u as d,w as y,x as c,z as E}from"./chunk-WTVOD2ZT.js";var J=(t,l)=>l.row,B=(t,l)=>l.id;function q(t,l){if(t&1){let e=P();i(0,"button",21),m("click",function(){let s=E(e).$implicit,a=S(2);return O(a.toggleSeatSelection(s))}),r(1),o()}if(t&2){let e=l.$implicit,n=S(2);w(n.getSeatClasses(e)),h("disabled",e.status===n.SeatStatus.OCCUPIED),p(),b(" ",e.number," ")}}function G(t,l){if(t&1){let e=P();i(0,"button",21),m("click",function(){let s=E(e).$implicit,a=S(2);return O(a.toggleSeatSelection(s))}),r(1),o()}if(t&2){let e=l.$implicit,n=S(2);w(n.getSeatClasses(e)),h("disabled",e.status===n.SeatStatus.OCCUPIED),p(),b(" ",e.number," ")}}function W(t,l){if(t&1&&(i(0,"div",6)(1,"div",18),_(2,q,2,4,"button",19,B),o(),u(4,"div",20),i(5,"div",18),_(6,G,2,4,"button",19,B),o()()),t&2){let e=l.$implicit;p(2),v(e.seats.slice(0,3)),p(4),v(e.seats.slice(3))}}var K=(()=>{class t{http;API_URL="assets/seat-map.json";REFRESH_INTERVAL=1e4;constructor(e){this.http=e}getSeatMap(e){return this.http.get(`${this.API_URL}`)}getSeatMapWithPolling(e){return T(this.REFRESH_INTERVAL).pipe(U(()=>this.getSeatMap(e)))}selectSeat(e,n){return this.http.post(`${this.API_URL}`,{})}unselectSeat(e,n){return this.http.post(`${this.API_URL}`,{})}static \u0275fac=function(n){return new(n||t)(y($))};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),z=(()=>{class t{state(e){return{$:()=>e.asObservable(),snapshot:()=>this.immutabilize(e.getValue()),set:n=>e.next(this.immutabilize(n))}}immutabilize(e){return JSON.parse(JSON.stringify(e))}static \u0275fac=function(n){return new(n||t)};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Q=(()=>{class t{_factory=c(z);seatMap$=new f({flightId:"",seats:[],selectedSeats:[]});store(){return{seatMap:this._factory.state(this.seatMap$)}}static \u0275fac=function(n){return new(n||t)};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),X=(()=>{class t{_factory=c(z);seats$=new f([]);selectedSeats$=new f([]);selectedSeatsId$=new f([]);store(){return{seats:this._factory.state(this.seats$),selectedSeats:this._factory.state(this.selectedSeats$),selectedSeatsId:this._factory.state(this.selectedSeatsId$)}}static \u0275fac=function(n){return new(n||t)};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),H=(()=>{class t{_seatMap=c(Q);_seats=c(X);get seatMap(){return this._seatMap.store()}get seats(){return this._seats.store()}static \u0275fac=function(n){return new(n||t)};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Z=(()=>{class t{_service=c(K);_state=c(H);subscriptions;errorSubject=new f(null);seats$(){return this._state.seats.seats.$()}selectedSeats$(){return this._state.seats.selectedSeats.$()}error$(){return this.errorSubject.asObservable()}initSubscriptions(){this.subscriptions=new M}destroySubscriptions(){this.subscriptions.unsubscribe(),this.errorSubject.complete()}execute(e){this.errorSubject.next(null),this.subscriptions.add(this._service.getSeatMap(e).pipe(j({next:n=>{this._state.seats.seats.set(n)},error:n=>{this.errorSubject.next(n.message||"Failed to fetch seats")}})).subscribe())}static \u0275fac=function(n){return new(n||t)};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),x=function(t){return t.FIRST="FIRST",t.BUSINESS="BUSINESS",t.ECONOMY="ECONOMY",t}(x||{}),g=function(t){return t.OCCUPIED="OCCUPIED",t.AVAILABLE="AVAILABLE",t.SELECTED="SELECTED",t}(g||{}),ee=(()=>{class t{http;apiUrl="http://localhost:8080/seats";constructor(e){this.http=e}getFlightSeats(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(D(n=>this.transformSeatsToRows(n)),I(this.handleError))}bookSeats(e,n){let s={flightId:e,seatIds:n};return this.http.put(`${this.apiUrl}/book`,s).pipe(I(this.handleError))}transformSeatsToRows(e){let n=e.reduce((s,a)=>(s[a.row]||(s[a.row]=[]),s[a.row].push(a),s),{});return Object.entries(n).map(([s,a])=>({row:parseInt(s),seats:a.sort((C,Y)=>C.column.localeCompare(Y.column))})).sort((s,a)=>s.row-a.row)}handleError(e){let n="An error occurred";return e.error instanceof ErrorEvent?n=e.error.message:n=`Error Code: ${e.status}
Message: ${e.message}`,console.error(n),F(()=>new Error(n))}static \u0275fac=function(n){return new(n||t)(y($))};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),te=(()=>{class t{seatService;flightId;seatMap=[];selectedSeats=[];selectedSeatsId=[];loading=!1;error=null;SeatStatus=g;onChoseSeat=A();constructor(e){this.seatService=e}ngOnInit(){this.loadSeats()}loadSeats(){this.loading=!0,this.error=null,this.seatService.getFlightSeats(this.flightId).subscribe({next:e=>{this.seatMap=e,this.loading=!1},error:e=>{this.error="Failed to load seats. Please try again.",this.loading=!1,console.error("Error loading seats:",e)}})}toggleSeatSelection(e){if(e.status===g.OCCUPIED)return;let n=this.selectedSeats.indexOf(e.number);n===-1?(this.selectedSeats.push(e.number),this.selectedSeatsId.push(e.id),e.status=g.SELECTED):(this.selectedSeats.splice(n,1),this.selectedSeatsId.splice(n,1),e.status=g.AVAILABLE)}getSeatClasses(e){return{seat:!0,"seat--occupied":e.status===g.OCCUPIED,"seat--selected":e.status===g.SELECTED,"seat--first":e.type===x.FIRST,"seat--business":e.type===x.BUSINESS,"seat--economy":e.type===x.ECONOMY}}getTotalPrice(){return this.seatMap.flatMap(e=>e.seats).filter(e=>this.selectedSeats.includes(e.number)).reduce((e,n)=>e+n.price,0)}bookSeats(){this.selectedSeats.length&&(this.loading=!0,this.error=null,this.onChoseSeat.emit(this.selectedSeatsId))}static \u0275fac=function(n){return new(n||t)(L(ee))};static \u0275cmp=k({type:t,selectors:[["lib-seat-map"]],inputs:{flightId:"flightId"},outputs:{onChoseSeat:"onChoseSeat"},decls:45,vars:3,consts:[[1,"seat-map-container"],[1,"seat-map-header"],[1,"aircraft-info"],[1,"fas","fa-plane"],[1,"seat-map-scroll"],[1,"seat-map-grid"],[1,"seat-row"],[1,"booking-info"],[1,"selection-info"],[1,"book-button",3,"click","disabled"],[1,"seat-legend"],[1,"legend-item"],[1,"legend-box"],[1,"legend-box","legend-box--occupied"],[1,"legend-box","legend-box--first"],[1,"legend-box","legend-box--business"],[1,"legend-box","legend-box--economy"],[1,"legend-box","legend-box--selected"],[1,"seat-group"],[3,"class","disabled"],[1,"aisle"],[3,"click","disabled"]],template:function(n,s){n&1&&(i(0,"div",0)(1,"div",1)(2,"h2"),r(3,"Select Seats"),o(),i(4,"div",2),u(5,"i",3),i(6,"span"),r(7,"Boeing 737/3"),o()()(),i(8,"div",4)(9,"div",5),_(10,W,8,0,"div",6,J),o()(),i(12,"div",7)(13,"div",8)(14,"p"),r(15),o(),i(16,"p"),r(17),o()(),i(18,"button",9),m("click",function(){return s.bookSeats()}),r(19," Book Selected Seats "),o()(),i(20,"div",10)(21,"div",11),u(22,"div",12),i(23,"span"),r(24,"Available"),o()(),i(25,"div",11),u(26,"div",13),i(27,"span"),r(28,"Occupied"),o()(),i(29,"div",11),u(30,"div",14),i(31,"span"),r(32,"First Class Seat"),o()(),i(33,"div",11),u(34,"div",15),i(35,"span"),r(36,"Business Class Seat"),o()(),i(37,"div",11),u(38,"div",16),i(39,"span"),r(40,"Economy Class Seat"),o()(),i(41,"div",11),u(42,"div",17),i(43,"span"),r(44,"Selected"),o()()()()),n&2&&(p(10),v(s.seatMap),p(5),b("Selected: ",s.selectedSeats.length?s.selectedSeats.join(", "):"None",""),p(2),b("Total: $",s.getTotalPrice().toFixed(2)," USD"),p(),h("disabled",s.selectedSeats.length===0))},styles:[".seat-map-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.seat-map-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.seat-map-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px}.aircraft-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.seat-map-scroll[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto;margin-bottom:20px}.seat-map-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:16px}.seat-row[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:24px}.seat-group[_ngcontent-%COMP%]{display:flex;gap:4px}.seat[_ngcontent-%COMP%]{width:32px;height:32px;border:1px solid #ccc;border-radius:4px;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .2s}.seat[_ngcontent-%COMP%]:hover:not(:disabled){background:#e6e6e6}.seat--occupied[_ngcontent-%COMP%]{background:#ccc;cursor:not-allowed}.seat--selected[_ngcontent-%COMP%]{background:#98bcf5;color:#fff;border-color:#12245f;border-width:3px}.seat--xl[_ngcontent-%COMP%]{background:#fbcfe8}.seat--xl[_ngcontent-%COMP%]:hover:not(:disabled){background:#f9a8d4}.seat[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.seat--first[_ngcontent-%COMP%]{background-color:gold}.seat--first[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#ffed4a}.seat--business[_ngcontent-%COMP%]{background-color:#89f189}.seat--business[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#cbd5e0}.seat--economy[_ngcontent-%COMP%]{background-color:#fff}.seat--economy[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f7fafc}.booking-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-top:1px solid #e5e7eb}.book-button[_ngcontent-%COMP%]{padding:8px 16px;background:#3b82f6;color:#fff;border:none;border-radius:4px;cursor:pointer}.book-button[_ngcontent-%COMP%]:disabled{background:#9ca3af;cursor:not-allowed}.book-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.seat-legend[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:20px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.legend-box[_ngcontent-%COMP%]{width:16px;height:16px;border:1px solid #ccc;border-radius:4px}.legend-box--occupied[_ngcontent-%COMP%]{background:#ccc}.legend-box--first[_ngcontent-%COMP%]{background:gold}.legend-box--business[_ngcontent-%COMP%]{background:#89f189}.legend-box--economy[_ngcontent-%COMP%]{background:#fbcfe8}.legend-box--selected[_ngcontent-%COMP%]{background:#98bcf5}"]})}return t})(),ne=(()=>{class t{_state=c(H);_router=c(R);subscriptions;initSubscriptions(){this.subscriptions=new M}destroySubscriptions(){this.subscriptions.unsubscribe()}selectedSeatsId$(){return this._state.seats.selectedSeatsId.$()}execute(e){this._state.seats.selectedSeatsId.set(e),this._router.navigate(["/pay"])}static \u0275fac=function(n){return new(n||t)};static \u0275prov=d({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),ie=(()=>{class t{_getSeatsUsecase=c(Z);_selectedSeatsUsecase=c(ne);seat$;seats$=this._getSeatsUsecase.seats$();selectedSeats$=this._getSeatsUsecase.selectedSeats$();selectedSeatsId$=this._selectedSeatsUsecase.selectedSeatsId$();error$=this._getSeatsUsecase.error$();_getFlightSelected=c(N);flight$;flightId="";ngOnInit(){this._getFlightSelected.initSubscription(),this.flight$=this._getFlightSelected.flight$(),this.flight$.subscribe(e=>{this.flightId=e.origin.id})}ngOnDestroy(){this._getFlightSelected.destroySubscription()}loadSeatMap(){}handleSeatSelection(e){this._selectedSeatsUsecase.execute(e)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=k({type:t,selectors:[["app-seat-map-container"]],decls:1,vars:1,consts:[[3,"onChoseSeat","flightId"]],template:function(n,s){n&1&&(i(0,"lib-seat-map",0),m("onChoseSeat",function(C){return s.handleSeatSelection(C)}),o()),n&2&&h("flightId",s.flightId)},dependencies:[te],encapsulation:2})}return t})(),he=[{path:"",component:V,children:[{path:"",component:ie}]},{path:"",redirectTo:"",pathMatch:"full"},{path:"**",redirectTo:"home"}];export{K as a,Z as b,ne as c,he as d};
